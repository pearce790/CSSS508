---
title: "Homework 5: 2016 Elections"
author: "KEY"
date: "Due"
output: 
  html_document:
    preserve_yaml: true
    toc: true
    toc_float: true
published: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
```

# Instructions

> Questions for you to answer are as quoted blocks of text. Put your code used to address these questions and interpretation below each block. Make sure your answers are NOT in block quotes like these. Load all libraries you want to use in the `setup` chunk; when you discover you want to use a library later, add it to the setup chunk at the top. You will turn in Part 1 for the coming week and Part 2 for the following week. You will upload the entire template each time, with whatever progress you have made.

# Homework 5

## Getting the data in

> Download the data from <https://raw.githubusercontent.com/breonh/breonh.github.io/main/csss_508/homework/homework_5/king_county_elections_2016.txt>. It is a plain text file of data, about 60 MB in size. Values are separated with commas. Read the file into R. You will want to use the `cache=TRUE` chunk option for this (and potentially other chunks). `cache=TRUE` will allow R to read the file only once to save time.


```{r import_data, message=FALSE,warning=FALSE,cache=TRUE}
king_county_elections_2016 <- read_csv("https://raw.githubusercontent.com/breonh/breonh.github.io/main/csss_508/homework/homework_5/king_county_elections_2016.txt")
```

## Inspecting the data

> Use `str()` and/or `summary()` to look at the data.  Describe the data in their current state. How many rows are there? What variables are there? What kinds of values do they take (don't list them all if there are many)? Are the column types sensible? 


```{r}
#str(king_county_elections_2016)
summary(king_county_elections_2016)
```

The data has `r nrow(king_county_elections_2016)` rows and `r ncol(king_county_elections_2016)` columns. The variable names are `r names(king_county_elections_2016)`. All column types are characters, besides those with numbers (which are numeric). The character data seem more like categorical data, so perhaps the factor type would be more appropriate.

> Now that you've looked at the data holistically, consider each variable individually (or in the case of `LEG`, `CC`, and `CG`, as a trio; I will tell you now that these variables won't be useful, but try to guess what they are). Remember these are real administrative data so they may be *really strangely structured* and some variables are indecipherable; in real world data work, you often have to get by with intuition or poking around online with regard to the nature of your data. As you look at each variable, present 1-2 reasonable summaries (such as a histogram, frequency table, etc.). If there are many categories, **don't** print them all out. Instead, print just the first few or provide a different type of summary.


### Precinct

```{r}
king_county_elections_2016 %>% distinct(Precinct) %>% 
  summarize(NumberUniquePrecincts=n())
king_county_elections_2016 %>% distinct(Precinct) %>% head(5)
```

### Race

```{r}
king_county_elections_2016 %>% distinct(Race) %>% 
  summarize(NumberUniqueRaces=n())
king_county_elections_2016 %>% distinct(Race) %>% head(5)
```

### LEG, CC, CG

```{r}
king_county_elections_2016 %>% select(LEG,CC,CG) %>% distinct() %>% head(10)
```

### CounterGroup

```{r}
king_county_elections_2016 %>% distinct(CounterGroup)
```

### Party

```{r}
king_county_elections_2016 %>% distinct(Party)  %>% head(10)
```

### CounterType

```{r}
king_county_elections_2016 %>% select(Precinct,Race,CounterType,SumOfCount) %>% 
  distinct(CounterType,.keep_all = TRUE) %>% head(10)
```

> Notice something odd about CounterType in particular? It tells you what a given row of votes was for... but it also has `Registered Voters` and `Times Counted`. What are these variables?

> Answer (Not Required!): `CounterType` displays different options for each political race. For example, in
> the first row, we see that 183 people voter for "Maintained" in Advisory Vote 14 in the ADAIR precinct.
> `Registered Voters` tells you the total number of register voters in this precinct and race, and 
> `Times Counted` tells you the total number of votes for that princt and race.

### SumOfCount

```{r cache=TRUE}
ggplot(king_county_elections_2016,aes(SumOfCount))+geom_histogram(bins=30)+
  ylab("Count")+xlab("Sum of Count Variable")+theme_bw(base_size=15)
```

## The quantities of interest

> We will focus on only the three major executive races in Washington in 2016:

> * President (and Vice-President)
> * Governor
> * Lieutenant Governor

> With these races, we are interested in:

> 1. **Turnout rates** for each of these races in each precinct. We will measure turnout as times votes were counted (including for a candidate, blank, write-in, or "over vote") divided by the number of registered voters.

> 2. Differences between precincts *in Seattle* and precincts *elsewhere in King County*. Again, these data are not documented, so you will have to figure out how to do this.

> 3. Precinct-level support for the Democratic candidates in King County in 2016 for each contest. We will measure support as the percentage of votes in a precinct for the Democratic candidate out of all votes for candidates or write-ins. Do not include blank votes or "over votes" (where the voter indicated multiple choices) in the overall vote count for the denominator.

> You will perform most of the data management for #1 and #2 in this homework. Next week's homework will contain most of the work for #3 and also covers visualizing results.

> The goal to accomplish over Homeworks 5 and 6 will be to get the data to one **row per precinct** with the following 7 columns:

> * Precinct identifier
> * Indicator for whether the precinct is in Seattle or not
> * Precinct size in terms of registered voters
> * Turnout rate
> * Percentage Democratic support for President
> * Percentage Democratic support for Governor
> * Percentage Democratic support for Lieutenant Governor

> The sections below describe steps you may want to do to get your data organized, and provide some hints and suggestions for methods, in particular using `dplyr` and `tidyr`.

## Filtering down the data

> For what we want to do, there are a lot of rows that are not useful. We only want ones pertaining to races for **President**, **Governor**, and **Lieutenant Governor**. So let's trim everything down. You will want to see how these things show up in the data. The easiest way may be to (1) display every unique value of `Race` and find which ones match our races of interest, then (2) filter the data to those races.

```{r}
executive_races <- king_county_elections_2016 %>% 
  filter(Race %in% c("US President & Vice President","Governor","Lieutenant Governor"))
```

## Seattle precincts

> We want to determine which precincts are in Seattle and which are not. The following code will create a vector indicating if a precinct is in Seattle or not:

`ifelse(substr(YOUR_DATA_NAME$Precinct, start = 1, stop = 4) == "SEA ","Seattle","Not Seattle")`

> Use and modify this code to create a variable in your dataset that indicates if a precinct is in Seattle or not. I would recommend using the `mutate()` function to make the new variable!



```{r}
executive_races <- executive_races %>% 
  mutate(Seattle = ifelse(substr(Precinct, start = 1, stop = 4) == "SEA ",
                          "Seattle","Not Seattle"))
```


## Registered voters and turnout rates

> We want to calculate turnout rates as total votes (including normal votes, blank votes, over votes, write-ins) for each race divided by registered voters. $Turnout = \frac{Total Votes}{Registered Voters}$. Once you've calculated turnout by race and precinct, display the first 9 rows. Be sure to still include whether or not the precinct is in Seattle! 

> Hint 1: The "Times Counted" rows in the `CounterType` variable includes the total number of votes in each race and precinct.

> Hint 2: Consider filtering your data to get the total votes and number of registered voters into unique columns; you *could* `left_join()` after to combine the datasets.

```{r}
TotalVotes <- executive_races %>% 
  select(Precinct,Race,Seattle,CounterType,SumOfCount) %>%
  filter(CounterType == "Times Counted") %>%
  rename("TotalVotes"= SumOfCount) %>%
  select(-CounterType)
RegisteredVotes <- executive_races %>% 
  select(Precinct,Race,CounterType,SumOfCount) %>%
  filter(CounterType == "Registered Voters") %>%
  rename("RegisteredVotes"= SumOfCount) %>%
  select(-CounterType)
Turnout <- TotalVotes %>% left_join(RegisteredVotes,by=c("Precinct","Race")) %>%
  mutate(Turnout = TotalVotes/RegisteredVotes)
Turnout %>% head(9)
```

> In total, our data has `r nrow(Turnout)` rows!

> That's it for Homework 5!

# Next Time

> In the next homework, we'll continue this analysis! 
